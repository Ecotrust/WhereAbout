{% extends "base.html" %}

{% block content %}

<script language="javascript">
function skip_group_verify(link) {
    var agree=confirm("Are you sure you want to skip this group?  You won't be able to undo this action.");
    if (agree) {
        location.href=link;
    }
}

function skip_res_verify(link) {
    var agree=confirm("Are you sure you want to skip the unfinished {{interview.resource_name_plural}} and finalize this group?  All data for those {{interview.resource_name_plural}} will be lost.");
    if (agree) {
        location.href=link;
    }
}
</script>

<br/>
<div style='width:600px;'>
{{ interview.group_status_text|safe }} 
</div>
<br/>

<a name='main_menu' />
{% if user.is_staff %}
    <a href='/reset_interview/{{interview.id}}'>Restart Survey</a>
    <br/>
    <br/>
{% endif %}
<a href="/accounts/logout/">Logout and finish later</a>
<br/>
<br/>
<ul>
{% for r in result %} 
    <li style='line-height:16px'>
    {% ifequal r.group_memb.status "finalized" %}
        <img src="/site-media/images/accept.png" alt="Finalized"/>
    {% endifequal %}    
    {% ifequal r.group_memb.status "skipped" %}
        <img src="/site-media/images/accept.png" alt="Skipped"/>
    {% endifequal %}    
    {% ifnotequal r.group_memb.status "finalized" %}
        {% ifnotequal r.group_memb.status "skipped" %}
            <img src="/site-media/images/delete.png" alt="Incomplete"/>
        {% endifnotequal %}
    {% endifnotequal %}
    <b>{{ r.group_memb.int_group.name|capfirst }}</b>: 
    
    {% ifequal r.group_memb.status "selecting resources" %}
        Selecting {{interview.resource_name}}
    {% else %}
        {{r.group_memb.status|capfirst}}
    {% endifequal %}
    
    {% ifequal r.group_memb.status "in-progress" %}    
        {% if r.group_memb.int_group.user_draws_shapes %}
            - {{r.group_memb.user_status_msg}}  
        {% endif %}
    {% endifequal %}
    <br/>
    
    {% ifnotequal r.group_memb.status "skipped" %}  
        <ul>
        {% ifequal r.group_memb.status "finalized" %}   
            <li>Done. <a href="/group_qs/{{r.group_memb.int_group.id}}/view/">Review answers</a></li>
            <li>Done. <a href="/unfinalize_group/{{r.group_memb.int_group.id}}/">Re-open this group</a></li>
        {% else %}
            {% if r.current %}
            {#{% ifequal current_group.int_group r.group_memb.int_group %}#}
                {% ifequal r.group_memb.status "in-progress" %}   
                    <li>Done. <a href="/group_qs/{{r.group_memb.int_group.id}}/answer/">Edit answers</a></li>
                {% else %}
                    {% ifequal r.group_memb.status "selecting resources" %}   
                        <li>Done. <a href="/group_qs/{{r.group_memb.int_group.id}}/answer/">Edit answers</a></li>
                    {% else %}
                        <li><a href="/group_qs/{{r.group_memb.int_group.id}}/answer/">Answer questions</a></li>
                    {% endifequal %}
                {% endifequal %} 
                {% ifequal r.group_memb.status "selecting resources" %}
                    <li><a href="/select_group_resources/{{r.group_memb.int_group.id}}/">Select {{interview.resource_name}}</a></li>
                {% endifequal %}
                {% ifequal r.group_memb.status "in-progress" %}
                    {% if r.group_memb.int_group.user_draws_shapes %}
                        <li>Done. <a href="/select_group_resources/{{r.group_memb.int_group.id}}/">Edit {{interview.resource_name}}</a></li>
                        <li>Done. <a href="/review_resource_questions/{{r.group_memb.int_group.id}}/">Edit {{interview.resource_name}}-specific answers</a></li>
                        <li>
                        {% ifequal num_shapes 0 %}
                            <a href="/draw_group_resources/{{r.group_memb.int_group.id}}/">Draw {{interview.shape_name_plural}}</a>
                        {% else %}                           
                            <a href="/draw_group_resources/{{r.group_memb.int_group.id}}/">Continue drawing/editing {{interview.shape_name_plural}}</a>
                        {% endifequal %}
                        </li>
                        {% ifnotequal r.group_memb.num_complete_resources 0 %}
                            <li>
                            {% ifequal r.group_memb.num_incomplete_resources 0 %}  
                                <a href="/finalize_group/{{r.group_memb.int_group.id}}/">Finalize this group</a>
                            {% else %}
                                <a href='#' onclick="skip_res_verify('/skip_res_finalize_group/{{r.group_memb.int_group.id}}/')">Skip remaining {{interview.resource_name_plural}} and finalize this group</a>
                            {% endifequal %}
                            </li>
                        {% endifnotequal %}
                    {% else %}  
                        <li><a href="/finalize_group/{{r.group_memb.int_group.id}}/">Finalize this group</a></li>       
                    {% endif %}
                {% endifequal %}
                
                {% ifnotequal forloop.counter 1 %}      {#  NOT MAIN  #}
                    {% ifnotequal forloop.counter 2 %}      {#  NOT PRIMARY GROUP  #}
                        <li><a href='#' onclick="skip_group_verify('/skip_group/{{r.group_memb.int_group.id}}/')">Skip this group</a></li>
                    {% endifnotequal %}
                {% endifnotequal %}
            {#{% endifequal %}#}
            {% endif %}
        {% endifequal %}
        </ul>
    {# {% else %} #}
         {# <ul>#}
            {#  <li>Skipped. <a href="/unskip_group/{{r.group_memb.int_group.id}}/">Re-open this group</a></li>#}
         {# </ul> #}
    {% endifnotequal %}
    <br/>
{% endfor %}

<li style='line-height:16px'>
<img src="/site-media/images/delete.png" alt="Incomplete"/>
<b> Interview status: in-progress</b>
{% if allow_finalize %}
    <ul><li>
    <a href="/finalize_interview/{{interview.id}}/">Finalize this interview</a></h4></li>
    </li></ul>
{% endif %}
</li>
</ul>
<div style="height: 600px" />
{% endblock %}
