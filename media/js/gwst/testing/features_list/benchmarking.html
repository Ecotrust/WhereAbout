<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <title>record object benchmarking</title>
        <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key={{GMAPS_API_KEY}}" type="text/javascript"></script>
        <script src="../../../lib/json2.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../OpenLayers-2.7/OpenLayers.js" type="text/javascript" charset="utf-8"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../proj4js/lib/proj4js-combined.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../ext-jquery-adapter.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../ext-all.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../proj4js/lib/defs/EPSG3310.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../proj4js/lib/defs/EPSG900913.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../gwst-debug.js" type="text/javascript" charset="utf-8"></script>
            
        <script type="text/javascript" charset="utf-8">
            function Mpa(data){
                this.pk = data.pk;
                this.name = data.name;
                this.extLabel = data.extLabel;
                this.fullname = data.author.fullname;
                this.geometry_clipped = data.geometry_clipped;
                this.geometry = data.geometry;
                this.username = data.author.username;
                this.user_id = data.author.pk;
                this.lastModified = data.date_modified;
                this.dateCreated = data.date_created;
                if(data.array){
                    this.array_id = data.array.pk;
                    this.arrayname = data.array.name;
                    this.arrayLabel = data.array.extGroupingLabel;
                }else{
                    this.array_id = '';
                    this.arrayname = '';
                    this.arrayLabel = '';
                }
                this.comments = data.comments;
                this.editable = data.editable;
            }
            
            Mpa.prototype.get = function(key){
                return this[key];
            }
        
            $(document).ready(function(){
                window.log = function(msg){
                    $('ul#out').append('<li>'+msg+'</li>');
                };
                window.times = {}
                window.timeStart = function(value){
                    var date1 = new Date();
                    window.times[value] = date1.getTime();
                };
                window.timeEnd = function(value){
                    var date2 = new Date();
                    return date2.getTime() - window.times[value];
                };
                
                $.get("mpas_service_response.json",
                    function(data, textStatus){
                        window.log(navigator.userAgent);
                        var num = 0;
                        var time = 0;
                        for(var i=0;i<num;i++){
                            timeStart('JSON parse');
                            var json = JSON.parse(data);
                            time = time + timeEnd('JSON parse');                            
                        }
                        window.log('JSON parse: '+time/num+' ms average (n='+num+')');

                        var time = 0;
                        for(var i=0;i<num;i++){
                            timeStart('eval');
                            var evaled = eval('('+data+')');
                            time = time + timeEnd('eval');                        
                        }
                        window.log('eval: '+time/num+' ms average (n='+num+')');
                        
                        var num = 1;
                        var time = 0;
                        var reader = new gwst.data.MLPAFeatureReader({root: 'results'}, gwst.data.MPA);
                        var json = JSON.parse(data);
                        for(var i=0;i<num;i++){
                            timeStart('extjs readrecords');
                            records = reader.readRecords(json).records;
                            time = time + timeEnd('extjs readrecords');                        
                        }
                        window.log('extjs readrecords: '+time/num+' ms average (n='+num+')');


                        var num = 1;
                        var time = 0;
                        var mpas = []
                        for(var i=0;i<num;i++){
                            timeStart('gwst object');
                            for(var i=0; i<json.results.length; i++){
                                mpas.push(Mpa(json.results[i]));
                            }
                            time = time + timeEnd('gwst object');                        
                        }
                        window.log('gwst object: '+time/num+' ms average (n='+num+')');
                       
                       var ds = new Ext.data.Store({
                         proxy: new Ext.data.MemoryProxy(json),
                         reader: new gwst.data.MLPAFeatureReader({root: 'results'}, gwst.data.MPA)
                       });
                       
                       timeStart('extjs store');
                       ds.load();
                       var time = timeEnd('extjs store');
                       window.log('extjs store: '+time + ' ms');
                       
                       timeStart('extjs store query for array mpas');
                       mpas = ds.query('array_id', 458);
                       var time = timeEnd('extjs store query for array mpas');
                       window.log('extjs store query for array mpas: '+time + ' ms');
                       

                       timeStart('extjs store find by pk');
                       for(var i=0; i<100;i++){
                           mpa = ds.find('pk', 148);
                       }
                       var time = timeEnd('extjs store find by pk');
                       window.log('extjs store find by pk: '+time + ' ms (performed 100 times)');
                       // console.log(ds);
                       // console.log(ds.getCount());
                       // console.log(ds.getAt(10).get('name'));
                    }
                );
            });
        </script>
    </head>
    <body>
        <h1>Benchmarks</h1>
        <ul id="out">
            
        </ul>
    </body>
</html>